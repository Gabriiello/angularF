<div class="usuarios-wrapper">
  <!-- Navbar -->
  <nav class="usuarios-navbar">
    <div class="navbar-logo">
      <span class="navbar-logo-icon">ğŸ‘¥</span>
      <span class="navbar-logo-text">GestiÃ³n de Usuarios</span>
    </div>
    <button class="btn-back" routerLink="/admin">
      <span>â†</span>
      <span>Volver al Panel</span>
    </button>
  </nav>

  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Administrar Usuarios</h1>
      <p class="page-subtitle">Gestiona cuentas, roles y permisos de todos los usuarios</p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-icon">ğŸ‘¤</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ usuarios.length }}</div>
          <div class="stat-label">Total Usuarios</div>
        </div>
      </div>

      <div class="stat-card" style="border-left-color: var(--secondary);">
        <div class="stat-header">
          <span class="stat-icon">ğŸ‘‘</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getAdminCount() }}</div>
          <div class="stat-label">Administradores</div>
        </div>
      </div>

      <div class="stat-card" style="border-left-color: var(--success);">
        <div class="stat-header">
          <span class="stat-icon">ğŸ“š</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getUserCount() }}</div>
          <div class="stat-label">Estudiantes</div>
        </div>
      </div>

      <div class="stat-card" style="border-left-color: var(--warning);">
        <div class="stat-header">
          <span class="stat-icon">âœ¨</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getActiveUsersCount() }}</div>
          <div class="stat-label">Activos Hoy</div>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-section">
      <div class="table-header">
        <h2 class="table-title">
          <span class="title-icon">ğŸ“‹</span>
          <span>Lista de Usuarios</span>
        </h2>
        <div class="search-filter">
          <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input
              type="text"
              class="search-input"
              placeholder="Buscar usuarios..."
              [(ngModel)]="searchTerm"
              (input)="filterUsuarios()"
            />
          </div>
          <button class="btn btn-add" (click)="showAddModal = true">
            <span>â•</span>
            <span>Nuevo Usuario</span>
          </button>
        </div>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of filteredUsuarios">
              <td>
                <div class="user-info">
                  <div class="user-avatar">{{ getInitials(usuario.nombre) }}</div>
                  <div class="user-details">
                    <div class="user-name">{{ usuario.nombre }}</div>
                    <div class="user-email">{{ usuario.email }}</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="role-badge" [ngClass]="{
                  'role-admin': usuario.rol === 'ADMIN',
                  'role-usuario': usuario.rol === 'USUARIO'
                }">
                  {{ usuario.rol === 'ADMIN' ? 'ğŸ‘‘ Administrador' : 'ğŸ“š Estudiante' }}
                </span>
              </td>
              <td>
                <span style="color: var(--success); font-weight: 600;">â— Activo</span>
              </td>
              <td>
                <div class="table-actions">
                  <button
                    class="btn-icon btn-edit"
                    (click)="editUsuario(usuario)"
                    title="Editar"
                  >
                    âœï¸
                  </button>
                  <button
                    class="btn-icon btn-delete"
                    (click)="confirmDelete(usuario.id)"
                    title="Eliminar"
                  >
                    ğŸ—‘ï¸
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div *ngIf="showEditModal" class="modal" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Editar Usuario</h2>
        <button class="modal-close" (click)="closeEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateUsuario()">
          <div class="form-group">
            <label for="nombre">Nombre Completo</label>
            <input
              id="nombre"
              type="text"
              [(ngModel)]="selectedUsuario.nombre"
              name="nombre"
              required
              placeholder="Ej: Juan PÃ©rez"
            />
          </div>

          <div class="form-group">
            <label for="email">Correo ElectrÃ³nico</label>
            <input
              id="email"
              type="email"
              [(ngModel)]="selectedUsuario.email"
              name="email"
              required
              placeholder="usuario@email.com"
            />
          </div>

          <div class="form-group">
            <label for="rol">Rol del Usuario</label>
            <select id="rol" [(ngModel)]="selectedUsuario.rol" name="rol" required>
              <option value="ADMIN">ğŸ‘‘ Administrador</option>
              <option value="USUARIO">ğŸ“š Estudiante</option>
            </select>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-cancel" (click)="closeEditModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <span>ğŸ’¾</span>
              <span>Guardar Cambios</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Add User Modal -->
  <div *ngIf="showAddModal" class="modal" (click)="closeAddModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Nuevo Usuario</h2>
        <button class="modal-close" (click)="closeAddModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addUsuario()">
          <div class="form-group">
            <label for="newNombre">Nombre Completo</label>
            <input
              id="newNombre"
              type="text"
              [(ngModel)]="newUsuario.nombre"
              name="newNombre"
              required
              placeholder="Ej: Juan PÃ©rez"
            />
          </div>

          <div class="form-group">
            <label for="newEmail">Correo ElectrÃ³nico</label>
            <input
              id="newEmail"
              type="email"
              [(ngModel)]="newUsuario.email"
              name="newEmail"
              required
              placeholder="usuario@email.com"
            />
          </div>

          <div class="form-group">
            <label for="newContrasena">ContraseÃ±a</label>
            <input
              id="newContrasena"
              type="password"
              [(ngModel)]="newUsuario.contrasena"
              name="newContrasena"
              required
              placeholder="MÃ­nimo 6 caracteres"
              minlength="6"
            />
          </div>

          <div class="form-group">
            <label for="newRol">Rol del Usuario</label>
            <select id="newRol" [(ngModel)]="newUsuario.rol" name="newRol" required>
              <option value="ADMIN">ğŸ‘‘ Administrador</option>
              <option value="USUARIO">ğŸ“š Estudiante</option>
            </select>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-cancel" (click)="closeAddModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <span>âœ“</span>
              <span>Crear Usuario</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>