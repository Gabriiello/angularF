<div class="cuestionarios-wrapper">
  <!-- Navbar -->
  <nav class="cuestionarios-navbar">
    <div class="navbar-logo">
      <span class="navbar-logo-icon">ğŸ“</span>
      <span class="navbar-logo-text">GestiÃ³n de Cuestionarios</span>
    </div>
    <div class="navbar-actions">
      <button class="btn-back" routerLink="/admin">
        <span>â†</span>
        <span>Volver al Panel</span>
      </button>
    </div>
  </nav>

  <div class="container">
    

    <!-- Add New Cuestionario Section -->
    <div class="add-section">
      <h2 class="section-title">
        <span class="section-icon">â•</span>
        <span>Nuevo Cuestionario</span>
      </h2>
      <form (ngSubmit)="addCuestionario()">
        <div class="form-grid">
          <div class="form-group">
            <label for="titulo">TÃ­tulo del Cuestionario</label>
            <input
              type="text"
              id="titulo"
              [(ngModel)]="newCuestionario.titulo"
              name="titulo"
              required
              placeholder="Ej: MatemÃ¡ticas BÃ¡sicas"
            />
          </div>
          <div class="form-group">
            <label for="descripcion">DescripciÃ³n</label>
            <textarea
              id="descripcion"
              [(ngModel)]="newCuestionario.descripcion"
              name="descripcion"
              required
              placeholder="Describe brevemente el contenido del cuestionario"
            ></textarea>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          <span>âœ“</span>
          <span>Crear Cuestionario</span>
        </button>
      </form>
    </div>

    <!-- List Section -->
    <div class="list-section">
      <h2 class="section-title">
        <span class="section-icon">ğŸ“‹</span>
        <span>Lista de Cuestionarios</span>
      </h2>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>TÃ­tulo</th>
              <th>DescripciÃ³n</th>
              <th>Preguntas</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cuestionario of cuestionarios">
              <td><strong>{{ cuestionario.titulo }}</strong></td>
              <td>{{ cuestionario.descripcion }}</td>
              <td>{{ cuestionario.Numpreguntas}}</td>
              <td>
                <div class="table-actions">
                  <button
                    class="btn-icon btn-edit"
                    (click)="editCuestionario(cuestionario)"
                    title="Editar"
                  >
                    âœï¸
                  </button>
                  <button
                    class="btn-icon btn-delete"
                    (click)="deleteCuestionario(cuestionario.id)"
                    title="Eliminar"
                  >
                    ğŸ—‘ï¸
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Edit Cuestionario Modal -->
  <div *ngIf="showEditModal" class="modal" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Editar Cuestionario</h2>
        <button class="modal-close" (click)="closeEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateCuestionario()">
          <div class="form-group">
            <label for="editTitulo">TÃ­tulo</label>
            <input
              type="text"
              id="editTitulo"
              [(ngModel)]="selectedCuestionario.titulo"
              name="editTitulo"
              required
            />
          </div>
          <div class="form-group">
            <label for="editDescripcion">DescripciÃ³n</label>
            <textarea
              id="editDescripcion"
              [(ngModel)]="selectedCuestionario.descripcion"
              name="editDescripcion"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">
            <span>ğŸ’¾</span>
            <span>Guardar Cambios</span>
          </button>
        </form>

        <!-- Preguntas Section -->
        <div class="nested-list">
          <div class="nested-header">
            <h3 class="nested-title">Preguntas del Cuestionario</h3>
            <button class="btn btn-success" (click)="showAddPreguntaModal = true">
              <span>â•</span>
              <span>Nueva Pregunta</span>
            </button>
          </div>

          <div *ngIf="preguntas.length > 0" class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Pregunta</th>
                  <th>Respuestas</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let pregunta of preguntas">
                  <td>{{ pregunta.texto }}</td>
                  <td>{{ pregunta.respuestas?.length || 0 }}</td>
                  <td>
                    <div class="table-actions">
                      <button
                        class="btn-icon btn-edit"
                        (click)="editPregunta(pregunta)"
                        title="Editar"
                      >
                        âœï¸
                      </button>
                      <button
                        class="btn-icon btn-delete"
                        (click)="deletePregunta(pregunta.id)"
                        title="Eliminar"
                      >
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div *ngIf="preguntas.length === 0" class="empty-state">
            <div class="empty-icon">â“</div>
            <p class="empty-text">No hay preguntas aÃºn. Agrega tu primera pregunta.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Pregunta Modal -->
  <div *ngIf="showAddPreguntaModal" class="modal" (click)="closeAddPreguntaModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Nueva Pregunta</h2>
        <button class="modal-close" (click)="closeAddPreguntaModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addPregunta()">
          <div class="form-group">
            <label for="nuevaPregunta">Texto de la Pregunta</label>
            <textarea
              id="nuevaPregunta"
              [(ngModel)]="newPregunta.texto"
              name="nuevaPregunta"
              required
              placeholder="Escribe aquÃ­ la pregunta"
            ></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" (click)="closeAddPreguntaModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <span>âœ“</span>
              <span>Agregar Pregunta</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Pregunta Modal -->
  <div *ngIf="showEditPreguntaModal" class="modal" (click)="closeEditPreguntaModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Editar Pregunta</h2>
        <button class="modal-close" (click)="closeEditPreguntaModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updatePregunta()">
          <div class="form-group">
            <label for="editPreguntaTexto">Texto de la Pregunta</label>
            <textarea
              id="editPreguntaTexto"
              [(ngModel)]="selectedPregunta.texto"
              name="editPreguntaTexto"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">
            <span>ğŸ’¾</span>
            <span>Guardar Cambios</span>
          </button>
        </form>

        <!-- Respuestas Section -->
        <div class="nested-list">
          <div class="nested-header">
            <h3 class="nested-title">Respuestas de la Pregunta</h3>
            <button class="btn btn-success" (click)="showAddRespuestaModal = true">
              <span>â•</span>
              <span>Nueva Respuesta</span>
            </button>
          </div>

          <div *ngIf="respuestas.length > 0" class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Respuesta</th>
                  <th>Â¿Es Correcta?</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let respuesta of respuestas">
                  <td>{{ respuesta.texto }}</td>
                  <td>
                    <span *ngIf="respuesta.esCorrecta" style="color: var(--success);">âœ“ SÃ­</span>
                    <span *ngIf="!respuesta.esCorrecta" style="color: var(--gray);">âœ— No</span>
                  </td>
                  <td>
                    <div class="table-actions">
                      <button
                        class="btn-icon btn-delete"
                        (click)="deleteRespuesta(respuesta.id)"
                        title="Eliminar"
                      >
                        ğŸ—‘ï¸
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div *ngIf="respuestas.length === 0" class="empty-state">
            <div class="empty-icon">ğŸ’¬</div>
            <p class="empty-text">No hay respuestas aÃºn. Agrega opciones de respuesta.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Respuesta Modal -->
  <div *ngIf="showAddRespuestaModal" class="modal" (click)="closeAddRespuestaModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Nueva Respuesta</h2>
        <button class="modal-close" (click)="closeAddRespuestaModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addRespuesta()">
          <div class="form-group">
            <label for="respuestaTexto">Texto de la Respuesta</label>
            <input
              type="text"
              id="respuestaTexto"
              [(ngModel)]="newRespuesta.texto"
              name="respuestaTexto"
              required
              placeholder="Escribe la respuesta"
            />
          </div>
          <div class="checkbox-group">
            <input
              type="checkbox"
              id="respuestaCorrecta"
              [(ngModel)]="newRespuesta.esCorrecta"
              name="respuestaCorrecta"
            />
            <label for="respuestaCorrecta">Â¿Esta es la respuesta correcta?</label>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" (click)="closeAddRespuestaModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <span>âœ“</span>
              <span>Agregar Respuesta</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>